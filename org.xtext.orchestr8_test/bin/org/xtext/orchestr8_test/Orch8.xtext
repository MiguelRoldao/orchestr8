// automatically generated by Xtext
grammar org.xtext.orchestr8_test.Orch8 with org.eclipse.xtext.common.Terminals

import "https://Orchestr8.com" 
import "http://www.eclipse.org/emf/2002/Ecore" as ecore

Model returns Model:
	(scores+=Score | instruments+=Instrument)*
	mixer=Mixer
	(scores+=Score | instruments+=Instrument)*
;

SetupCommand returns Command:
	CmdTempo | CmdTimeSignature | CmdInstrument | CmdSet
;

Command returns Command:
	CmdTempo | CmdTimeSignature | CmdPlay | CmdInstrument | CmdSet;


Mixer returns Mixer:
	'Mixer' name=EString '{'
		('sampling_rate' sampling_rate=EInt)?
		'scores' '{' scores+=[Score|EString] (',' scores+=[Score|EString])* '}'
	'}';

Score returns Score:
	'Score' name=EString '{'
		('@Setup' (setup+=SetupCommand)* )?
		(measures+=Measure)+
		('@End' (end+=SetupCommand)* )?
	'}';

Instrument returns Instrument:
	'Instrument' name=EString '{'
		generator=Generator
		(parameters+=Parameter)*
	'}';

EString returns ecore::EString:
	STRING | ID;

EInt returns ecore::EInt:
	'-'? INT;

EDouble returns ecore::EDouble:
	'-'? INT? '.' INT (('E'|'e') '-'? INT)?;

Measure returns Measure:
	{Measure}
	'@' ID=EInt
	(beats+=Beat)+
;

CmdInstrument returns CmdInstrument:
	type='instrument' parameter=Parameter
;

CmdPlay returns CmdPlay:
	type='play' note=NOTE 'length' length=EDouble
;

CmdTempo returns CmdTempo:
	type='tempo' bpm=EInt
;

CmdTimeSignature returns CmdTimeSignature:
	type='time_signature' numerator=EInt '/' denominator=EInt
;

CmdSet returns CmdSet:
	type='set' instrument=[Instrument|EString]
;

Parameter returns Parameter:
	ID=EString value=EDouble
;

Beat returns Beat:
	':' ID=EDouble
	(commands+=Command)+
;

Generator returns Generator:
	mode=('type'|'custom') type=EString
;

terminal NOTE: ('a'..'g'|'A'..'G')('b'|'#')?('0'..'9');
